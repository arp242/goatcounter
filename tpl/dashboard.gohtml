<!DOCTYPE html>
<html lang="en">
<head>
	{{template "_favicon.gohtml" .}}
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>{{if .GoatcounterCom}}{{.Site.Code}} – {{end}}GoatCounter</title>
	<link rel="stylesheet" href="{{.Static}}/all.min.css?v={{.Version}}">
	<link rel="stylesheet" href="{{.Static}}/pikaday.css?v={{.Version}}">
	<link rel="stylesheet" href="{{.Static}}/style_backend.css?v={{.Version}}">
</head>

<div class="page">
	{{- if .Flash}}<div class="flash flash-{{.Flash.Level}}">{{.Flash.Message}}</div>{{end -}}
<form id="dash-form">
	{{/* The first button gets used on the enter key, AFAICT there is no way to change that. */}}
	<button type="submit" tabindex="-1" class="hide-btn" aria-label="Submit"></button>
	{{if .ShowRefs}}<input type="hidden" name="showrefs" value="{{.ShowRefs}}">{{end}}
	<input type="hidden" id="hl-period" name="hl-period" value="{{.View.Period}}" disabled>

	{{if .User.ID}}
		<div id="dash-saved-views">
			<span>⚙&#xfe0f;</span>
			<div>
				<a href="#" class="save-current-view">Save default view</a><br>
				<small>Save the current view (i.e. all the settings in the yellow box) as the default to load when nothing is selected yet.</small>
				<br><br>
				{{/* TODO: it might be better to load the settings page "inline"
				here, instead of a settings tab; would also declutter that a bit
				since we can remove it there. */}}
				<a href="/user/dashboard">Configure dashboard layout</a><br>
				<small>Change what to display on the dashboard and in what order.</small>
			</div>
		</div>
	{{end}}

	<div id="dash-main">
		<div>
			<span>
				<input type="text" class="date-input" autocomplete="off" title="Start of date range to display" id="period-start" name="period-start" value="{{tformat .PeriodStart "" .User}}">–{{- "" -}}
				<input type="text" class="date-input" autocomplete="off" title="End of date range to display"   id="period-end"   name="period-end" value="{{tformat .PeriodEnd "" .User}}">{{- "" -}}
			</span>
			<span id="dash-select-period" class="period-{{.View.Period}}">
				<span>
					后退
					<button class="link" name="period" value="day">一天</button> ·
					<button class="link" name="period" value="week">一周</button> ·
					<button class="link" name="period" value="month">一月</button> ·
					<button class="link" name="period" value="quarter">180天</button> ·
					<button class="link" name="period" value="half-year">半年</button> ·
					<button class="link" name="period" value="year">一年</button>
				</span>

				<span>
					当前
					<button class="link" name="period" value="week-cur">一周</button> ·
					<button class="link" name="period" value="month-cur">一月</button>
				</span>
			</span>
		</div>

		<div>
			<div class="filter-wrap">
				<input
					type="text" autocomplete="off" name="filter" value="{{.View.Filter}}" id="filter-paths"
					placeholder="Filter paths" title="Filter the list of paths; matched case-insensitive on path and title"
					{{if .View.Filter}}class="value"{{end}}>
			</div>
			<label><input type="checkbox" name="as-text" id="as-text" {{if .View.AsText}}checked{{end}}> 根据表格方式查看 </label>
			<input type="hidden" name="as-text" value="off">
			{{if .ForcedDaily}}
				<label title="Cannot use the hourly view for a time range of more than 90 days"><input type="checkbox" name="daily" checked disabled> View by day</label>
			{{else}}
				<label><input type="checkbox" name="daily" id="daily" {{if .View.Daily}}checked{{end}}> 根据天数查看 </label>
				<input type="hidden" name="daily" value="off">
			{{end}}
		</div>
	</div>
	<div id="dash-move">
		<div>
			←&#xfe0e; back
			<span>
				<button class="link" name="move" value="day-b">一天</button> ·
				<button class="link" name="move" value="week-b">一周</button> ·
				<button class="link" name="move" value="month-b">一月</button>
			</span>
		</div>
		<div id="dash-timerange">{{daterange .User.Settings.Timezone.Loc .PeriodStart .PeriodEnd}}</div>
		<div>
			<span>
				<button class="link" name="move" value="day-f">一天</button> ·
				<button class="link" name="move" value="week-f">一周</button> ·
				<button class="link" name="move" value="month-f">一月</button>
			</span>
			forward →&#xfe0e;
		</div>
	</div>
</form>
<span class="hide js-total-unique">{{.TotalUnique}}</span>
<span class="hide js-total-unique-utc">{{.TotalUniqueUTC}}</span>

{{template "_dashboard_widgets.gohtml" .}}

	</div> {{- /* .page */}}
	{{if and .User.ID .Billing (eq .Path "/") (.Site.ShowPayBanner .Context)}}
		<div id="trial-expired">
			<p>Hey hey; you’ve been using GoatCounter for more than 14 days.<br>
				Please choose if you want to subscribe to a plan or continue with the
				free plan on the <a href="/billing">billing page</a>.</p>
		</div>
	{{end}}
	<span id="js-settings"
		data-offset="{{.User.Settings.Timezone.Offset}}"
		data-first-hit-at="{{.Site.FirstHitAt.Unix}}"
		{{if .User.ID}}data-csrf="{{.User.CSRFToken}}"{{end}}
	>
		{{- .User.Settings.String | unsafe_js -}}
	</span>

	<script crossorigin="anonymous" src="{{.Static}}/jquery.js?v={{.Version}}"></script>
	<script crossorigin="anonymous" src="{{.Static}}/pikaday.js?v={{.Version}}"></script>
	<script crossorigin="anonymous" src="{{.Static}}/script_backend.js?v={{.Version}}"></script>
</body>
</html>
